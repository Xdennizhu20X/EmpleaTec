<div class="min-h-screen bg-gradient-to-br from-blue-50 to-blue-100">
  <!-- Header -->
  <header class="sticky top-0 z-40 border-b border-white/30 bg-transparent backdrop-blur-lg">
    <div class="container mx-auto px-6 py-4">
      <div class="flex items-center justify-between">
        <button (click)="onBack()" class="flex items-center rounded-lg border border-white/30 bg-white/20 py-2 px-4 backdrop-blur-lg transition-colors duration-300 hover:bg-white/30">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5m7 7l-7-7 7-7"/></svg>
          Volver
        </button>
        
        <div class="flex items-center space-x-4">
          <h1 class="text-xl font-bold text-blue-900">Mensajes</h1>
          <span *ngIf="totalUnreadMessages > 0" class="rounded-full bg-blue-500 px-2.5 py-1 text-xs font-bold text-white">
            {{ totalUnreadMessages }}
          </span>
        </div>
        
        <button (click)="onLogout()" class="rounded-lg border border-white/30 bg-white/20 py-2 px-4 text-blue-600 backdrop-blur-lg transition-colors duration-300 hover:bg-red-50/20 hover:text-red-600" title="Cerrar sesión">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4m7 10l5-5-5-5m5 5H9"/></svg>
          <span class="hidden sm:inline ml-2">Cerrar sesión</span>
        </button>
      </div>
    </div>
  </header>

  <div class="container mx-auto max-w-4xl px-6 py-8">
    <!-- Search Bar -->
    <div class="mb-8 rounded-2xl border border-white/20 bg-white/50 p-6 shadow-lg backdrop-blur-lg">
      <div class="relative">
        <svg xmlns="http://www.w3.org/2000/svg" class="absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 transform text-blue-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21 21-6-6m2-5a7 7 0 1 1-14 0 7 7 0 0 1 14 0z"/></svg>
        <input
          type="text"
          placeholder="Buscar conversaciones..."
          [(ngModel)]="searchQuery"
          (ngModelChange)="filterChats()"
          class="w-full border-0 bg-transparent pl-12 text-lg focus:outline-none"
        />
      </div>
    </div>

    <!-- Stats -->
    <div class="mb-8 grid gap-4 md:grid-cols-3">
      <div class="rounded-2xl border border-white/20 bg-white/50 p-4 text-center shadow-lg backdrop-blur-lg">
        <div class="text-2xl font-bold text-blue-800">{{ recentChats.length }}</div>
        <div class="text-sm text-blue-600">Conversaciones</div>
      </div>
      <div class="rounded-2xl border border-white/20 bg-white/50 p-4 text-center shadow-lg backdrop-blur-lg">
        <div class="text-2xl font-bold text-blue-800">{{ totalUnreadMessages }}</div>
        <div class="text-sm text-blue-600">Sin leer</div>
      </div>
      <div class="rounded-2xl border border-white/20 bg-white/50 p-4 text-center shadow-lg backdrop-blur-lg">
        <div class="text-2xl font-bold text-blue-800">{{ onlineCount }}</div>
        <div class="text-sm text-blue-600">En línea</div>
      </div>
    </div>

    <!-- Chats List -->
    <div class="space-y-4">
      <div *ngIf="filteredChats.length === 0" class="rounded-2xl border border-white/20 bg-white/50 p-12 text-center shadow-lg backdrop-blur-lg">
        <div class="mb-4 text-blue-400">
          <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-16 w-16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
        </div>
        <h3 class="mb-2 text-lg font-semibold text-blue-800">
          No hay conversaciones
        </h3>
        <p class="text-blue-600">
          {{ searchQuery ? 'No encontramos conversaciones que coincidan con tu búsqueda' : 'Aún no tienes conversaciones. ¡Empieza contactando a un profesional!' }}
        </p>
      </div>

      <div *ngFor="let chat of filteredChats" (click)="handleChatClick(chat)" class="cursor-pointer rounded-2xl border border-white/20 bg-white/50 p-6 shadow-lg backdrop-blur-lg transition-all duration-300 hover:scale-[1.02] hover:bg-white/30">
        <div class="flex items-start space-x-4">
          <!-- Avatar -->
          <div class="relative">
            <img [src]="chat.participant.avatar" [alt]="chat.participant.name" class="h-14 w-14 rounded-full">
            <div *ngIf="chat.participant.isOnline" class="absolute -bottom-1 -right-1 h-4 w-4 rounded-full border-2 border-white bg-green-500"></div>
          </div>

          <!-- Chat Info -->
          <div class="min-w-0 flex-1">
            <div class="mb-2 flex items-start justify-between">
              <div>
                <h4 class="truncate font-semibold text-blue-900">
                  {{ chat.participant.name }}
                </h4>
                <p *ngIf="chat.participant.specialty" class="text-sm text-blue-600">
                  {{ chat.participant.specialty }}
                </p>
              </div>
              <div class="ml-4 flex items-center space-x-2">
                <span class="text-sm text-blue-500">
                  {{ formatTimeAgo(chat.lastMessage.timestamp) }}
                </span>
                <span *ngIf="chat.unreadCount > 0" class="flex h-5 min-w-[20px] items-center justify-center rounded-full bg-blue-500 text-xs text-white">
                  {{ chat.unreadCount }}
                </span>
              </div>
            </div>

            <!-- Project Title -->
            <div class="mb-2">
              <span class="rounded-full border border-blue-300 bg-white/60 px-3 py-1 text-xs text-blue-700">
                {{ chat.projectTitle }}
              </span>
            </div>

            <!-- Last Message -->
            <div class="flex items-center space-x-2">
              <p class="truncate flex-1 text-sm" [ngClass]="{'font-medium text-blue-800': chat.unreadCount > 0, 'text-blue-600': chat.unreadCount === 0}">
                {{ chat.lastMessage.text }}
              </p>
              
              <!-- Message Status -->
              <div *ngIf="user && chat.lastMessage.senderId === user.id" class="flex-shrink-0">
                <svg *ngIf="chat.lastMessage.isRead" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-blue-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L7 17l-5-5m20-5L7 12"/></svg>
                <svg *ngIf="!chat.lastMessage.isRead" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-blue-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6L9 17l-5-5"/></svg>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div *ngIf="filteredChats.length > 0" class="mt-8 text-center">
      <a routerLink="/worker-explorer" class="inline-flex items-center rounded-lg border border-white/30 bg-white/20 py-2 px-4 text-blue-700 backdrop-blur-lg transition-colors duration-300 hover:bg-white/30">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
        Encontrar más profesionales
      </a>
    </div>
  </div>
</div>
''
