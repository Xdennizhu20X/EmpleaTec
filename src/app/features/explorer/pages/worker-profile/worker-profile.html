<div class="min-h-screen bg-gray-100 font-sans">
  @if(worker(); as worker) {
    <!-- Header Section -->
    <header class="relative h-60 md:h-80">
      <button (click)="onBack()" class="absolute top-4 left-4 z-10 p-2 rounded-full bg-white/20 hover:bg-white/40 backdrop-blur-sm transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
        </svg>
      </button>
      <img [src]="worker.coverURL || 'https://images.unsplash.com/photo-1557682250-33bd709cbe85'" alt="Cover Photo" class="w-full h-full object-cover">
      <div class="absolute inset-0 bg-black/50"></div>
      <div class="absolute bottom-0 left-1/2 -translate-x-1/2 translate-y-1/2">
        <img [src]="worker.photoURL || 'https://via.placeholder.com/150'" alt="Worker Avatar" class="w-32 h-32 rounded-full border-4 border-white shadow-lg object-cover">
      </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto p-4 pt-20 md:p-8 md:pt-24">
      <div class="max-w-5xl mx-auto">
        <!-- Name and Actions -->
        <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center text-center sm:text-left gap-4 mb-8">
          <div>
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800">{{ worker.displayName }}</h1>
            <div class="flex items-center justify-center sm:justify-start gap-4 mt-2 text-gray-600">
              <div class="flex items-center gap-1">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-500" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>
                <span class="font-semibold">{{ worker.stats?.averageRating || 'Nuevo' }}</span>
              </div>
              <span class="text-gray-300">•</span>
              <div class="flex items-center gap-1">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" /></svg>
                <span>{{ worker.city || 'Ubicación no definida' }}</span>
              </div>
            </div>
          </div>
          <div class="flex gap-2 sm:gap-4 flex-shrink-0">
            <button (click)="contactWorker(worker)" class="px-4 py-2 md:px-6 md:py-3 rounded-full bg-blue-100 text-blue-700 font-semibold hover:bg-blue-200 transition-colors">Enviar Mensaje</button>
            <button class="px-4 py-2 md:px-6 md:py-3 rounded-full bg-blue-600 text-white font-semibold hover:bg-blue-700 transition-colors">Contratar</button>
          </div>
        </div>

        <!-- Main layout grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
          <!-- Left Column (About, Skills, Portfolio) -->
          <div class="lg:col-span-2 space-y-8">
            <!-- About Me -->
            <div class="bg-white p-6 rounded-xl shadow-sm">
              <h2 class="text-xl font-bold text-gray-800 mb-4">Acerca de mí</h2>
              <p class="text-gray-600 leading-relaxed">{{ worker.description || 'No hay una descripción disponible.' }}</p>
            </div>

            <!-- Skills -->
            <div class="bg-white p-6 rounded-xl shadow-sm">
              <h2 class="text-xl font-bold text-gray-800 mb-4">Oficios</h2>
              <div class="flex flex-wrap gap-2">
                @for(oficio of worker.oficios; track oficio) {
                  <span class="bg-blue-100 text-blue-800 text-sm font-semibold px-3 py-1 rounded-full">{{ oficio }}</span>
                }
              </div>
            </div>

            <!-- Portfolio -->
            <div class="bg-white p-6 rounded-xl shadow-sm">
              <h2 class="text-xl font-bold text-gray-800 mb-4">Portafolio</h2>
              @if(worker.portfolio && worker.portfolio.length > 0) {
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                  @for(item of worker.portfolio; track item.imageUrl) {
                    <img [src]="item.imageUrl" alt="Portfolio item" class="w-full h-48 object-cover rounded-lg shadow-md cursor-pointer" (click)="openModal(item.imageUrl)">
                  }
                </div>
              } @else {
                <p class="text-gray-500">Aún no hay imágenes en el portafolio.</p>
              }
            </div>
          </div>

          <!-- Right Column (Verification, Stats) -->
          <div class="lg:col-span-1 space-y-6">
            <!-- Verification -->
            <div class="bg-white p-6 rounded-xl shadow-sm">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Verificación</h3>
              <ul class="space-y-3">
                <li class="flex items-center gap-3">
                  <span class="w-8 h-8 rounded-full flex items-center justify-center" [ngClass]="worker.isVerified ? 'bg-green-100 text-green-600' : 'bg-gray-100 text-gray-400'">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm3.733 8.088a.75.75 0 001.06-1.06l-3.5-3.5a.75.75 0 00-1.06 0l-1.5 1.5a.75.75 0 101.06 1.06l.97-.97 3.03 3.03z" clip-rule="evenodd" /></svg>
                  </span>
                  <span class="font-medium text-gray-700">Perfil Verificado</span>
                </li>
              </ul>
            </div>

            <!-- Stats -->
            <div class="bg-white p-6 rounded-xl shadow-sm">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Estadísticas</h3>
              <ul class="space-y-4">
                <li class="flex justify-between items-center">
                  <span class="font-medium text-gray-600">Trabajos completados</span>
                  <span class="font-bold text-gray-800">{{ worker.stats?.totalJobs || 0 }}</span>
                </li>
                <li class="flex justify-between items-center">
                  <span class="font-medium text-gray-600">Años de experiencia</span>
                  <span class="font-bold text-gray-800">{{ worker.experience || 0 }}</span>
                </li>
                <li class="flex justify-between items-center">
                  <span class="font-medium text-gray-600">Miembro desde</span>
                  <span class="font-bold text-gray-800">{{ formatDate(worker.createdAt) }}</span>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </main>
  } @else {
    <div class="flex items-center justify-center min-h-screen">
      <p class="text-gray-500">Cargando perfil del trabajador...</p>
    </div>
  }

  <!-- Image Modal -->
  @if(isModalOpen()) {
    <div class="fixed inset-0 bg-black/70 z-50 flex items-center justify-center" (click)="closeModal()">
      <img [src]="selectedImage()" alt="Portfolio Image" class="max-w-4xl max-h-[90vh] rounded-lg shadow-2xl" (click)="$event.stopPropagation()">
    </div>
  }
</div>